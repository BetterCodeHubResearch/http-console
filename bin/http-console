#!/usr/bin/env node

var path = require('path'),
    sys = require('sys');

require.paths.unshift(path.join(__dirname, '..', 'lib'));

var httpConsole = require('http-console');

var argv = process.argv.slice(2), args = [],
    arg, option,
    options = {
        rememberCookies: false,
        useSSL:          protocol === 'https',
        verbose:         false
    };

while (arg = argv.shift()) {
    if (option = arg.match(/^--?(\w+)$/)) {
        switch (option[1]) {
            case 'cookies':
                options.rememberCookies = true;
                break;
            case 'ssl':
                options.useSSL = true;
                break;
            case 'v':
            case 'verbose':
                options.verbose = true;
                break;
            case 'version':
                sys.print('http-console v' + httpConsole.version);
                process.exit(0);
            default:
                sys.print("http-console: unrecognized option '" + option[0] + "'");
                process.exit(1);
        }
    } else {
        args.push(arg);
    }
}

var hostPort = args.shift() || 'http://127.0.0.1:80',
    protocol = hostPort.match(/^(https?)?/)[0] || 'http';

hostPort = hostPort.replace(protocol + '://', '').split(':');

var host = hostPort[0],
    port = hostPort[1] || (options.useSSL ? 443 : 80);

var console = new(httpConsole.Console)(host, port, options);

console.initialize();


